<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodel="clr-namespace:MauiAppUIDemo.ViewModels"
    xmlns:models="clr-namespace:MauiAppUIDemo.Models"
    x:Class="MauiAppUIDemo.Views.ProductListView"
    x:DataType="viewmodel:OrderPageViewModel">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- DANH SÃCH MÃ“N Ä‚N -->
        <StackLayout Grid.Column="0" Padding="10">
            <!-- TÃ¬m kiáº¿m vÃ  danh má»¥c -->
            <Grid ColumnDefinitions="*,Auto" Padding="0,0,0,10" ColumnSpacing="10">

                <!-- SearchBar bá»c trong Frame -->
                <Frame Grid.Column="0"
           Padding="0"
           CornerRadius="20"
           BorderColor="#ccc"
           HasShadow="False"
           HeightRequest="40"
           VerticalOptions="Center">
                    <SearchBar Placeholder="TÃ¬m mÃ³n..."
                   Text="{Binding SearchText}"
                   BackgroundColor="White"
                   FontSize="14"
                   Margin="10,0"
                   CancelButtonColor="Gray" />
                </Frame>

                <!-- Picker bá»c trong Frame -->
                <Frame Grid.Column="1"
                       Padding="0"
                       CornerRadius="20"
                       BorderColor="#ccc"
                       HasShadow="False"
                       HeightRequest="40"
                       VerticalOptions="Center">
                    <Picker Title="Táº¥t cáº£         ðŸ”½"
                        ItemsSource="{Binding Categories}"
                        SelectedItem="{Binding SelectedCategory}"
                        WidthRequest="140"
                        FontSize="14"
                        Margin="10,0" />
                </Frame>

            </Grid>

            <CollectionView ItemsSource="{Binding FilteredProducts}"
                            ItemsLayout="VerticalGrid, 3"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Product">
                        <Frame Padding="0" Margin="5"
                               BorderColor="#ddd"
                               CornerRadius="10"
                               HasShadow="False"
                               BackgroundColor="White">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- áº¢nh -->
                                <Grid Grid.Row="0">
                                    <Image Source="{Binding ImageUrl}"
                                           Aspect="AspectFill"
                                           HeightRequest="120"
                                           HorizontalOptions="Fill"
                                           VerticalOptions="Fill" />
                                </Grid>

                                <!-- TÃªn -->
                                <Label Grid.Row="1"
                                       Text="{Binding Name}"
                                       FontAttributes="Bold"
                                       FontSize="14"
                                       HorizontalTextAlignment="Center"
                                       Margin="5,4,5,0"/>

                                <!-- GiÃ¡ + Tráº¡ng thÃ¡i -->
                                <HorizontalStackLayout Grid.Row="2"
                                                       Margin="5,0,5,6"
                                                       HorizontalOptions="Center"
                                                       Spacing="10">
                                    <Label Text="{Binding Price, StringFormat='GiÃ¡: {0:N0} Ä‘'}"
                                           FontSize="11"
                                           TextColor="#21498c"/>
                                    <Label Text="{Binding StatusText}"
                                           FontSize="11"
                                           TextColor="{Binding StatusColor}" />
                                </HorizontalStackLayout>
                            </Grid>

                            <!-- Click Ä‘á»ƒ thÃªm mÃ³n -->
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OrderPageViewModel}}, Path=AddToOrderCommand}"
                                    CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>

        <!-- GIá»Ž HÃ€NG -->
        <StackLayout Grid.Column="1" BackgroundColor="#F5F5F5" Padding="5">
            <Label Text="HÃ³a Ä‘Æ¡n"
                   Padding="5"
                   FontAttributes="Bold"
                   FontSize="16"
                   Margin="0,0,0,10"
                   BackgroundColor="#21498c"
                   HorizontalOptions="Fill"
                   HorizontalTextAlignment="Center"
                   TextColor="White" />

            <CollectionView ItemsSource="{Binding OrderItems}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:OrderItem">
                        <Grid Padding="5" RowSpacing="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="1"/>
                            </Grid.RowDefinitions>

                            <StackLayout Grid.Row="0" VerticalOptions="Center">
                                <Label Text="{Binding Name}" FontSize="16"/>
                                <Label Text="{Binding ToppingSummary}"
                                       FontSize="13"
                                       TextColor="Gray"
                                       LineBreakMode="TailTruncation" />
                                <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto"
                                      Padding="0"
                                      ColumnSpacing="5"
                                      Margin="0,10,0,0"
                                      VerticalOptions="Center">
                                    <!-- NÃºt Giáº£m -->
                                    <Frame Grid.Column="0"
                                           CornerRadius="20"
                                           Padding="0"
                                           BackgroundColor="LightGray"
                                           HasShadow="False"
                                           VerticalOptions="Center">
                                        <Label Text="âž–" FontSize="16" TextColor="Aqua">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OrderPageViewModel}}, Path=DecreaseQuantityCommand}"
                                                    CommandParameter="{Binding .}" />
                                            </Label.GestureRecognizers>
                                        </Label>
                                    </Frame>

                                    <!-- Sá»‘ lÆ°á»£ng -->
                                    <Label Grid.Column="1"
                                           Text="{Binding Quantity}"
                                           VerticalOptions="Center"
                                           FontSize="14"/>
                                    <!-- NÃºt TÄƒng -->
                                    <Frame Grid.Column="2"
                                           CornerRadius="20"
                                           Padding="0"
                                           BackgroundColor="LightGray"
                                           HasShadow="False"
                                           VerticalOptions="Center">
                                        <Label Text="âž•" FontSize="16" TextColor="White">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer
                                                     Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OrderPageViewModel}}, Path=IncreaseQuantityCommand}"
                                                     CommandParameter="{Binding .}" />
                                            </Label.GestureRecognizers>
                                        </Label>
                                    </Frame>

                                    <!-- Subtotal -->
                                    <Label Grid.Column="3"
                                           Text="{Binding Subtotal, StringFormat='GiÃ¡ tiá»n: {0:N0} Ä‘'}"
                                           TextColor="Maroon"
                                           FontSize="14"
                                           HorizontalOptions="FillAndExpand"
                                           HorizontalTextAlignment="End"
                                           VerticalOptions="Center" />

                                    <!-- NÃºt XoÃ¡ -->
                                    <Frame Grid.Column="4"
                                           CornerRadius="20"
                                           Padding="0"
                                           BackgroundColor="LightGray"
                                           HasShadow="False"
                                           VerticalOptions="Center">
                                        <Label Text="âŒ" FontSize="16" TextColor="Red">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OrderPageViewModel}}, Path=RemoveItemCommand}"
                                                    CommandParameter="{Binding .}" />
                                            </Label.GestureRecognizers>
                                          </Label>
                                    </Frame>
                                </Grid>
                          </StackLayout>

                            <!-- Gáº¡ch phÃ¢n cÃ¡ch -->
                            <BoxView Grid.Row="1" HeightRequest="1" BackgroundColor="#CCC" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Chá»n mÃ£ giáº£m giÃ¡ -->
            <Label Text="Chá»n mÃ£ giáº£m giÃ¡:"
                   FontSize="14"
                   Margin="0,10,0,2" />
            <Button Text="{Binding SelectedDiscount, Converter={StaticResource DiscountDisplayConverter}}"
        Command="{Binding ShowDiscountPopupCommand}"
        BackgroundColor="#6C2DC7"       
                TextColor="White"
        FontSize="14"
        CornerRadius="16"
        HeightRequest="48"
        Padding="16,10"
        HorizontalOptions="Fill">
                <Button.Shadow>
                    <Shadow Brush="#44000000" Offset="2,2" Radius="5" Opacity="0.4"/>
                </Button.Shadow>
            </Button>


            <Label Text="{Binding DiscountAmountFormatted}"
                   TextColor="Red"
                   FontSize="14"
                   Margin="0,5,0,0"
                   HorizontalOptions="End" />

            <!-- Tá»•ng tiá»n -->
            <BoxView HeightRequest="1" Color="Gray" Margin="0,10"/>
            <Grid Padding="10" BackgroundColor="#21498c">
                <Label Text="{Binding TotalPriceFormatted, StringFormat='Thanh ToÃ¡n: {0}'}"
                       TextColor="White"
                       FontSize="20"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
            </Grid>
        </StackLayout>
    </Grid>
</ContentView>
